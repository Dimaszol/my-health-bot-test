{% extends "base.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç{% endblock %}

{% block content %}
<!-- üìä –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ -->

<!-- üëã –ü–†–ò–í–ï–¢–°–¢–í–ò–ï -->
<div style="margin-bottom: 2rem;">
    <h1 style="color: #667eea; margin-bottom: 0.5rem;">
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.name }}! üëã
    </h1>
    <p style="color: #666; font-size: 1.1rem;">
        –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∫–∞–±–∏–Ω–µ—Ç
    </p>
</div>

<!-- üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
    <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã -->
    <div class="card" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üìÑ</div>
        <h3 style="font-size: 2rem; margin-bottom: 0.5rem;">{{ stats.total_documents }}</h3>
        <p style="color: #666;">–ó–∞–≥—Ä—É–∂–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
        <p style="color: #999; font-size: 0.9rem; margin-top: 0.5rem;">
            –û—Å—Ç–∞–ª–æ—Å—å: {{ stats.documents_left }}
        </p>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="card" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üí¨</div>
        <h3 style="font-size: 2rem; margin-bottom: 0.5rem;">{{ stats.total_messages }}</h3>
        <p style="color: #666;">–°–æ–æ–±—â–µ–Ω–∏–π —Å –ò–ò</p>
        <p style="color: #999; font-size: 0.9rem; margin-top: 0.5rem;">
            –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤: {{ stats.queries_left }}
        </p>
    </div>
    
    <!-- –°—Ç–∞—Ç—É—Å -->
    <div class="card" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 0.5rem;">‚ú®</div>
        <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Free Plan</h3>
        <p style="color: #666;">–¢–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ</p>
        <a href="#" style="color: #667eea; font-size: 0.9rem; margin-top: 0.5rem; display: inline-block;">
            –£–ª—É—á—à–∏—Ç—å ‚Üí
        </a>
    </div>
</div>

<!-- üöÄ –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø -->
<div style="margin-bottom: 3rem;">
    <h2 style="color: #333; margin-bottom: 1.5rem;">
        üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    </h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
        <!-- –ß–∞—Ç -->
        <a href="/dashboard/chat" style="text-decoration: none;">
            <div class="card" style="cursor: pointer; transition: all 0.3s;">
                <div style="font-size: 2.5rem; margin-bottom: 1rem;">üí¨</div>
                <h3>–ß–∞—Ç —Å –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</h3>
                <p style="color: #666;">
                    –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –≤–∞—à–µ–º –∑–¥–æ—Ä–æ–≤—å–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                </p>
            </div>
        </a>
        
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <a href="/dashboard/documents" style="text-decoration: none;">
            <div class="card" style="cursor: pointer; transition: all 0.3s;">
                <div style="font-size: 2.5rem; margin-bottom: 1rem;">üì§</div>
                <h3>–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h3>
                <p style="color: #666;">
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞–Ω–∞–ª–∏–∑—ã, —Å–Ω–∏–º–∫–∏ –∏–ª–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –≤—Ä–∞—á–µ–π
                </p>
            </div>
        </a>
        
        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <a href="/dashboard/profile" style="text-decoration: none;">
            <div class="card" style="cursor: pointer; transition: all 0.3s;">
                <div style="font-size: 2.5rem; margin-bottom: 1rem;">üë§</div>
                <h3>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
                <p style="color: #666;">
                    –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à—É –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –∞–Ω–∫–µ—Ç—É
                </p>
            </div>
        </a>
    </div>
</div>

<!-- üìÑ –ü–û–°–õ–ï–î–ù–ò–ï –î–û–ö–£–ú–ï–ù–¢–´ -->
{% if documents %}
<div style="margin-bottom: 3rem;">
    <h2 style="color: #333; margin-bottom: 1.5rem;">
        üìÑ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    </h2>
    
    <div style="background: #f8f9fa; border-radius: 10px; overflow: hidden;">
        {% for doc in documents[:5] %}
        <div style="padding: 1rem 1.5rem; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h4 style="color: #333; margin-bottom: 0.3rem;">{{ doc.title }}</h4>
                <p style="color: #999; font-size: 0.9rem;">
                    {% if doc.uploaded_at %}
                        –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {{ doc.uploaded_at.strftime('%d.%m.%Y') }}
                    {% else %}
                        –ó–∞–≥—Ä—É–∂–µ–Ω–æ: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                    {% endif %}
                </p>
            </div>
            <div>
                <span style="background: #667eea; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85rem;">
                    {{ doc.file_type }}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div style="text-align: center; margin-top: 1rem;">
        <a href="/dashboard/documents" class="btn">
            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã ‚Üí
        </a>
    </div>
</div>
{% else %}
<div class="alert alert-info">
    <strong>üí° –°–æ–≤–µ—Ç:</strong> –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. 
    <a href="/dashboard/documents" style="color: #0c5460; text-decoration: underline;">
        –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
    </a>
</div>
{% endif %}

<!-- üí¨ –ü–û–°–õ–ï–î–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–Ø -->
{% if chat_history %}
<div>
    <h2 style="color: #333; margin-bottom: 1.5rem;">
        üí¨ –ü–æ—Å–ª–µ–¥–Ω—è—è –±–µ—Å–µ–¥–∞ —Å –ò–ò
    </h2>
    
    <div class="chat-container">
        {% for msg in chat_history[:5] %}
        <div class="chat-message {% if msg.role == 'user' %}user-msg{% else %}ai-msg{% endif %}">
            <div class="chat-bubble">
                {{ msg.message }}
            </div>
            <div class="chat-time">
                {% if msg.timestamp %}
                    {{ msg.timestamp.strftime('%H:%M') }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div style="text-align: center; margin-top: 1rem;">
        <a href="/dashboard/chat" class="btn">
            –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ—Å–µ–¥—É ‚Üí
        </a>
    </div>
</div>
{% else %}
<div class="alert alert-info">
    <strong>üëã –ü—Ä–∏–≤–µ—Ç!</strong> –ù–∞—á–Ω–∏—Ç–µ –±–µ—Å–µ–¥—É —Å –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º. 
    <a href="/dashboard/chat" style="color: #0c5460; text-decoration: underline;">
        –ó–∞–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
    </a>
</div>
{% endif %}

{% endblock %}

{% block extra_styles %}
<style>
    /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ */
    .chat-container {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        max-height: 400px;
        overflow-y: auto;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ */
    .chat-message {
        margin-bottom: 1rem;
    }
    
    .user-msg {
        text-align: right;
    }
    
    .ai-msg {
        text-align: left;
    }
    
    .chat-bubble {
        display: inline-block;
        padding: 0.8rem 1.2rem;
        border-radius: 15px;
        max-width: 70%;
        word-wrap: break-word;
    }
    
    .user-msg .chat-bubble {
        background: #667eea;
        color: white;
    }
    
    .ai-msg .chat-bubble {
        background: white;
        color: #333;
        border: 1px solid #e0e0e0;
    }
    
    .chat-time {
        font-size: 0.75rem;
        color: #999;
        margin-top: 0.3rem;
    }
</style>
{% endblock %}