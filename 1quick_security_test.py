# corrected_security_test.py - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô —Ç–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

from db import update_user_field

def test_sql_injection():
    """–¢–µ—Å—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π"""
    print("üß™ –¢–µ—Å—Ç 1: SQL –∏–Ω—ä–µ–∫—Ü–∏—è")
    try:
        result = update_user_field(123, 'name', "'; DROP TABLE users; --")
        # –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ True - —ç—Ç–æ –ø–ª–æ—Ö–æ (–∞—Ç–∞–∫–∞ –ø—Ä–æ—à–ª–∞)
        if result:
            print("‚ùå SQL –∏–Ω—ä–µ–∫—Ü–∏—è –ü–†–û–®–õ–ê - —ç—Ç–æ –ü–õ–û–•–û!")
        else:
            print("‚úÖ SQL –∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ - —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ False")
    except Exception as e:
        # –ï—Å–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ - —ç—Ç–æ —Ö–æ—Ä–æ—à–æ (–∞—Ç–∞–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞)
        print(f"‚úÖ SQL –∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º: {str(e)[:50]}")

def test_forbidden_field():
    """–¢–µ—Å—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π"""
    print("\nüß™ –¢–µ—Å—Ç 2: –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –ø–æ–ª–µ")
    try:
        result = update_user_field(123, 'admin', 'true')
        if result:
            print("‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –û–ë–ù–û–í–õ–ï–ù–û - —ç—Ç–æ –ü–õ–û–•–û!")
        else:
            print("‚úÖ –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ - —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ False")
    except Exception as e:
        print(f"‚úÖ –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º: {str(e)[:50]}")

def test_invalid_user_id():
    """–¢–µ—Å—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ user_id"""
    print("\nüß™ –¢–µ—Å—Ç 3: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π user_id")
    try:
        result = update_user_field(-1, 'name', 'test')
        if result:
            print("‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –ü–†–ò–ù–Ø–¢ - —ç—Ç–æ –ü–õ–û–•–û!")
        else:
            print("‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ False")
    except Exception as e:
        print(f"‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º: {str(e)[:50]}")

def test_normal_operation():
    """–¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã"""
    print("\nüß™ –¢–µ—Å—Ç 4: –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞")
    try:
        result = update_user_field(123, 'name', '–ò–≤–∞–Ω')
        if result:
            print("‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ")
        else:
            print("‚ö†Ô∏è –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ—à–ª–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: {e}")

def main():
    print("üõ°Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –¢–ï–°–¢ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò")
    print("=" * 50)
    
    test_sql_injection()
    test_forbidden_field()
    test_invalid_user_id()
    test_normal_operation()
    
    print("\n" + "=" * 50)
    print("üìä –ò–ù–¢–ï–†–ü–†–ï–¢–ê–¶–ò–Ø:")
    print("‚úÖ = –ó–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ")
    print("‚ùå = –ù–∞–π–¥–µ–Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç—å")
    print("‚ö†Ô∏è = –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è")

if __name__ == "__main__":
    main()